{"meta":{"timestamp":"2025-07-08T05:28:45.118581","version":"9.2.1","argv":["-r","G:\\화이트햇스쿨\\Web\\YARRAI_Web\\backend\\services\\CAPA\\capa-rules","-s","G:\\화이트햇스쿨\\Web\\YARRAI_Web\\backend\\services\\CAPA\\capa-sigs","--json","G:\\화이트햇스쿨\\Web\\YARRAI_Web\\backend\\uploads\\b5f0c566-bdfa-4289-9fa3-e3f314ee0eb6.exe"],"sample":{"md5":"fe29ff06620f100ed30f591311d797e1","sha1":"fbdc10b7b9e5107677d49f6e3da459956dbd409a","sha256":"a4ff0e94ef541c0ea4d46229180370817c5383de7f774f9803f551bb5103624f","path":"G:/화이트햇스쿨/Web/YARRAI_Web/backend/uploads/b5f0c566-bdfa-4289-9fa3-e3f314ee0eb6.exe"},"flavor":"static","analysis":{"format":"pe","arch":"amd64","os":"windows","extractor":"VivisectFeatureExtractor","rules":["G:/화이트햇스쿨/Web/YARRAI_Web/backend/services/CAPA/capa-rules"],"base_address":{"type":"absolute","value":6442450944},"layout":{"functions":[{"address":{"type":"absolute","value":6442455040},"matched_basic_blocks":[{"address":{"type":"absolute","value":6442455040}}]},{"address":{"type":"absolute","value":6442455134},"matched_basic_blocks":[{"address":{"type":"absolute","value":6442455139}},{"address":{"type":"absolute","value":6442455160}}]},{"address":{"type":"absolute","value":6442455171},"matched_basic_blocks":[{"address":{"type":"absolute","value":6442455171}},{"address":{"type":"absolute","value":6442455414}},{"address":{"type":"absolute","value":6442455580}},{"address":{"type":"absolute","value":6442455614}},{"address":{"type":"absolute","value":6442455802}}]},{"address":{"type":"absolute","value":6442455819},"matched_basic_blocks":[{"address":{"type":"absolute","value":6442455880}},{"address":{"type":"absolute","value":6442456567}},{"address":{"type":"absolute","value":6442456669}},{"address":{"type":"absolute","value":6442456864}},{"address":{"type":"absolute","value":6442456928}},{"address":{"type":"absolute","value":6442457007}},{"address":{"type":"absolute","value":6442457211}},{"address":{"type":"absolute","value":6442457367}}]},{"address":{"type":"absolute","value":6442457484},"matched_basic_blocks":[{"address":{"type":"absolute","value":6442457484}}]},{"address":{"type":"absolute","value":6442457666},"matched_basic_blocks":[{"address":{"type":"absolute","value":6442457545}},{"address":{"type":"absolute","value":6442457666}}]},{"address":{"type":"absolute","value":6442464582},"matched_basic_blocks":[{"address":{"type":"absolute","value":6442464582}}]},{"address":{"type":"absolute","value":6442464629},"matched_basic_blocks":[{"address":{"type":"absolute","value":6442464698}},{"address":{"type":"absolute","value":6442464735}},{"address":{"type":"absolute","value":6442464780}},{"address":{"type":"absolute","value":6442465021}}]},{"address":{"type":"absolute","value":6442465066},"matched_basic_blocks":[{"address":{"type":"absolute","value":6442465066}}]},{"address":{"type":"absolute","value":6442465122},"matched_basic_blocks":[{"address":{"type":"absolute","value":6442465122}},{"address":{"type":"absolute","value":6442465216}},{"address":{"type":"absolute","value":6442465288}}]},{"address":{"type":"absolute","value":6442465298},"matched_basic_blocks":[{"address":{"type":"absolute","value":6442465319}},{"address":{"type":"absolute","value":6442465365}},{"address":{"type":"absolute","value":6442465375}}]},{"address":{"type":"absolute","value":6442465405},"matched_basic_blocks":[{"address":{"type":"absolute","value":6442465405}},{"address":{"type":"absolute","value":6442465491}},{"address":{"type":"absolute","value":6442465540}}]},{"address":{"type":"absolute","value":6442465550},"matched_basic_blocks":[{"address":{"type":"absolute","value":6442465550}},{"address":{"type":"absolute","value":6442465648}},{"address":{"type":"absolute","value":6442465687}},{"address":{"type":"absolute","value":6442465929}},{"address":{"type":"absolute","value":6442465977}}]},{"address":{"type":"absolute","value":6442465986},"matched_basic_blocks":[{"address":{"type":"absolute","value":6442465986}}]},{"address":{"type":"absolute","value":6442466123},"matched_basic_blocks":[{"address":{"type":"absolute","value":6442466123}},{"address":{"type":"absolute","value":6442466223}},{"address":{"type":"absolute","value":6442466335}},{"address":{"type":"absolute","value":6442466394}},{"address":{"type":"absolute","value":6442466442}},{"address":{"type":"absolute","value":6442466729}}]},{"address":{"type":"absolute","value":6442466743},"matched_basic_blocks":[{"address":{"type":"absolute","value":6442466743}},{"address":{"type":"absolute","value":6442466879}},{"address":{"type":"absolute","value":6442466926}},{"address":{"type":"absolute","value":6442467012}},{"address":{"type":"absolute","value":6442467103}},{"address":{"type":"absolute","value":6442467198}},{"address":{"type":"absolute","value":6442467265}},{"address":{"type":"absolute","value":6442467341}}]},{"address":{"type":"absolute","value":6442467356},"matched_basic_blocks":[{"address":{"type":"absolute","value":6442467356}},{"address":{"type":"absolute","value":6442467423}},{"address":{"type":"absolute","value":6442467471}},{"address":{"type":"absolute","value":6442467485}}]},{"address":{"type":"absolute","value":6442467504},"matched_basic_blocks":[{"address":{"type":"absolute","value":6442467504}},{"address":{"type":"absolute","value":6442469203}},{"address":{"type":"absolute","value":6442469389}},{"address":{"type":"absolute","value":6442469509}}]},{"address":{"type":"absolute","value":6442467716},"matched_basic_blocks":[{"address":{"type":"absolute","value":6442467753}},{"address":{"type":"absolute","value":6442467838}},{"address":{"type":"absolute","value":6442467881}}]},{"address":{"type":"absolute","value":6442467924},"matched_basic_blocks":[{"address":{"type":"absolute","value":6442467981}},{"address":{"type":"absolute","value":6442468110}},{"address":{"type":"absolute","value":6442468298}},{"address":{"type":"absolute","value":6442468540}}]},{"address":{"type":"absolute","value":6442468713},"matched_basic_blocks":[{"address":{"type":"absolute","value":6442468740}},{"address":{"type":"absolute","value":6442468775}}]},{"address":{"type":"absolute","value":6442468784},"matched_basic_blocks":[{"address":{"type":"absolute","value":6442468784}},{"address":{"type":"absolute","value":6442468813}},{"address":{"type":"absolute","value":6442468832}},{"address":{"type":"absolute","value":6442468917}}]},{"address":{"type":"absolute","value":6442468933},"matched_basic_blocks":[{"address":{"type":"absolute","value":6442468933}},{"address":{"type":"absolute","value":6442468993}},{"address":{"type":"absolute","value":6442469075}},{"address":{"type":"absolute","value":6442469118}}]},{"address":{"type":"absolute","value":6442469175},"matched_basic_blocks":[{"address":{"type":"absolute","value":6442469203}},{"address":{"type":"absolute","value":6442469389}},{"address":{"type":"absolute","value":6442469509}}]}]},"feature_counts":{"file":77777,"functions":[{"address":{"type":"absolute","value":6442455040},"count":18},{"address":{"type":"absolute","value":6442455121},"count":10},{"address":{"type":"absolute","value":6442455134},"count":27},{"address":{"type":"absolute","value":6442455171},"count":94},{"address":{"type":"absolute","value":6442455819},"count":175},{"address":{"type":"absolute","value":6442457484},"count":32},{"address":{"type":"absolute","value":6442457666},"count":38},{"address":{"type":"absolute","value":6442464158},"count":10},{"address":{"type":"absolute","value":6442464544},"count":15},{"address":{"type":"absolute","value":6442464582},"count":20},{"address":{"type":"absolute","value":6442464629},"count":61},{"address":{"type":"absolute","value":6442465032},"count":15},{"address":{"type":"absolute","value":6442465066},"count":23},{"address":{"type":"absolute","value":6442465122},"count":48},{"address":{"type":"absolute","value":6442465298},"count":31},{"address":{"type":"absolute","value":6442465405},"count":48},{"address":{"type":"absolute","value":6442465550},"count":62},{"address":{"type":"absolute","value":6442465986},"count":23},{"address":{"type":"absolute","value":6442466123},"count":104},{"address":{"type":"absolute","value":6442466743},"count":91},{"address":{"type":"absolute","value":6442467356},"count":46},{"address":{"type":"absolute","value":6442467504},"count":66},{"address":{"type":"absolute","value":6442467548},"count":19},{"address":{"type":"absolute","value":6442467716},"count":61},{"address":{"type":"absolute","value":6442467924},"count":102},{"address":{"type":"absolute","value":6442468713},"count":33},{"address":{"type":"absolute","value":6442468784},"count":48},{"address":{"type":"absolute","value":6442468933},"count":64},{"address":{"type":"absolute","value":6442469175},"count":60},{"address":{"type":"absolute","value":6442469522},"count":10}]},"library_functions":[{"address":{"type":"absolute","value":6442464080},"name":"_alloca_probe"}]}},"rules":{"calculate modulo 256 via x86 assembly":{"meta":{"name":"calculate modulo 256 via x86 assembly","authors":["moritz.raabe@mandiant.com"],"scopes":{"static":"instruction"},"attack":[],"mbc":[{"parts":["Data","Modulo"],"objective":"Data","behavior":"Modulo","method":"","id":"C0058"}],"references":[],"examples":["9324D1A8AE37A36AE560C37448C9705A:0x4049A9"],"description":"","lib":true,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: calculate modulo 256 via x86 assembly\r\n    authors:\r\n      - moritz.raabe@mandiant.com\r\n    lib: true\r\n    scopes:\r\n      static: instruction\r\n      dynamic: unsupported  # requires mnemonic features\r\n    mbc:\r\n      - Data::Modulo [C0058]\r\n    examples:\r\n      - 9324D1A8AE37A36AE560C37448C9705A:0x4049A9\r\n  features:\r\n    #  and ecx, 800000FFh\r\n    #  and ecx, 0FFh\r\n    - and:\r\n      - or:\r\n        - arch: i386\r\n        - arch: amd64\r\n      - mnemonic: and\r\n      - or:\r\n        - number: 0x800000FF\r\n        - number: 0xFF\r\n","matches":[[{"type":"absolute","value":6442465853},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"arch","arch":"i386"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"arch","arch":"amd64"}},"children":[],"locations":[{"type":"no address"}],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"mnemonic","mnemonic":"and"}},"children":[],"locations":[{"type":"absolute","value":6442465853}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"number","number":2147483903}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"number","number":255}},"children":[],"locations":[{"type":"absolute","value":6442465853}],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"delay execution":{"meta":{"name":"delay execution","authors":["michael.hunhoff@mandiant.com","@ramen0x3f"],"scopes":{"static":"basic block","dynamic":"call"},"attack":[],"mbc":[{"parts":["Anti-Behavioral Analysis","Dynamic Analysis Evasion","Delayed Execution"],"objective":"Anti-Behavioral Analysis","behavior":"Dynamic Analysis Evasion","method":"Delayed Execution","id":"B0003.003"}],"references":["https://docs.microsoft.com/en-us/windows/win32/sync/wait-functions","https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/TimingAttacks/timing.cpp"],"examples":["al-khaser_x86.exe_:0x449770","B5F85C26D7AA5A1FB4AF5821B6B5AB9B:0x402FA6"],"description":"","lib":true,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: delay execution\r\n    authors:\r\n      - michael.hunhoff@mandiant.com\r\n      - \"@ramen0x3f\"\r\n    lib: true\r\n    scopes:\r\n      static: basic block\r\n      dynamic: call\r\n    mbc:\r\n      - Anti-Behavioral Analysis::Dynamic Analysis Evasion::Delayed Execution [B0003.003]\r\n    references:\r\n      - https://docs.microsoft.com/en-us/windows/win32/sync/wait-functions\r\n      - https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/TimingAttacks/timing.cpp\r\n    examples:\r\n      - al-khaser_x86.exe_:0x449770\r\n      - B5F85C26D7AA5A1FB4AF5821B6B5AB9B:0x402FA6\r\n  features:\r\n    - or:\r\n      - and:\r\n        - os: windows\r\n        - or:\r\n          - api: kernel32.Sleep\r\n          - api: kernel32.SleepEx\r\n          - api: kernel32.WaitForSingleObject\r\n          - api: kernel32.SignalObjectAndWait\r\n          - api: kernel32.WaitForSingleObjectEx\r\n          - api: kernel32.WaitForMultipleObjects\r\n          - api: kernel32.WaitForMultipleObjectsEx\r\n          - api: kernel32.RegisterWaitForSingleObject\r\n          - api: WaitOnAddress\r\n          - api: user32.MsgWaitForMultipleObjects\r\n          - api: user32.MsgWaitForMultipleObjectsEx\r\n          - api: NtDelayExecution\r\n          - api: KeWaitForSingleObject\r\n          - api: KeDelayExecutionThread\r\n      - and:\r\n        - or:\r\n          - os: linux\r\n          - os: android\r\n        - or:\r\n          - api: sleep\r\n          - api: usleep\r\n","matches":[[{"type":"absolute","value":6442455139},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"os","os":"linux"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"os","os":"android"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"sleep"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"usleep"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"os","os":"windows"}},"children":[],"locations":[{"type":"no address"}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"Sleep"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SleepEx"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"WaitForSingleObject"}},"children":[],"locations":[{"type":"absolute","value":6442455146}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SignalObjectAndWait"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WaitForSingleObjectEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WaitForMultipleObjects"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WaitForMultipleObjectsEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegisterWaitForSingleObject"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"WaitOnAddress"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"MsgWaitForMultipleObjects"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"MsgWaitForMultipleObjectsEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtDelayExecution"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"KeWaitForSingleObject"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"KeDelayExecutionThread"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"create or open registry key":{"meta":{"name":"create or open registry key","authors":["michael.hunhoff@mandiant.com","anushka.virgaonkar@mandiant.com"],"scopes":{"static":"basic block","dynamic":"call"},"attack":[],"mbc":[{"parts":["Operating System","Registry","Create Registry Key"],"objective":"Operating System","behavior":"Registry","method":"Create Registry Key","id":"C0036.004"},{"parts":["Operating System","Registry","Open Registry Key"],"objective":"Operating System","behavior":"Registry","method":"Open Registry Key","id":"C0036.003"}],"references":[],"examples":["Practical Malware Analysis Lab 03-02.dll_:0x10004706","Practical Malware Analysis Lab 11-01.exe_:0x401000","493167E85E45363D09495D0841C30648:0x404D60","B5F85C26D7AA5A1FB4AF5821B6B5AB9B:0x4045F2","B5F85C26D7AA5A1FB4AF5821B6B5AB9B:0x40433E","692f7fd6d198e804d6af98eb9e390d61:0x6000003"],"description":"","lib":true,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: create or open registry key\r\n    authors:\r\n      - michael.hunhoff@mandiant.com\r\n      - anushka.virgaonkar@mandiant.com\r\n    lib: true\r\n    scopes:\r\n      static: basic block\r\n      dynamic: call\r\n    mbc:\r\n      - Operating System::Registry::Create Registry Key [C0036.004]\r\n      - Operating System::Registry::Open Registry Key [C0036.003]\r\n    examples:\r\n      - Practical Malware Analysis Lab 03-02.dll_:0x10004706\r\n      - Practical Malware Analysis Lab 11-01.exe_:0x401000\r\n      - 493167E85E45363D09495D0841C30648:0x404D60\r\n      - B5F85C26D7AA5A1FB4AF5821B6B5AB9B:0x4045F2\r\n      - B5F85C26D7AA5A1FB4AF5821B6B5AB9B:0x40433E\r\n      - 692f7fd6d198e804d6af98eb9e390d61:0x6000003\r\n  features:\r\n    - or:\r\n      - api: advapi32.RegOpenKey\r\n      - api: advapi32.RegOpenKeyEx\r\n      - api: advapi32.RegCreateKey\r\n      - api: advapi32.RegCreateKeyEx\r\n      - api: advapi32.RegOpenCurrentUser\r\n      - api: advapi32.RegOpenKeyTransacted\r\n      - api: advapi32.RegOpenUserClassesRoot\r\n      - api: advapi32.RegCreateKeyTransacted\r\n      - api: ZwOpenKey\r\n      - api: ZwOpenKeyEx\r\n      - api: ZwCreateKey\r\n      - api: ZwOpenKeyTransacted\r\n      - api: ZwOpenKeyTransactedEx\r\n      - api: ZwCreateKeyTransacted\r\n      - api: NtOpenKey\r\n      - api: NtCreateKey\r\n      - api: SHRegOpenUSKey\r\n      - api: SHRegCreateUSKey\r\n      - api: RtlCreateRegistryKey\r\n      - api: Microsoft.Win32.RegistryKey::OpenSubKey\r\n      - api: Microsoft.Win32.RegistryKey::OpenBaseKey\r\n      - api: Microsoft.Win32.RegistryKey::OpenRemoteBaseKey\r\n      - api: Microsoft.Win32.RegistryKey::CreateSubKey\r\n","matches":[[{"type":"absolute","value":6442455880},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegOpenKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegOpenKeyEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegCreateKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegCreateKeyEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegOpenCurrentUser"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegOpenKeyTransacted"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"api","api":"RegOpenUserClassesRoot"}},"children":[],"locations":[{"type":"absolute","value":6442456237}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RegCreateKeyTransacted"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwOpenKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwOpenKeyEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwCreateKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwOpenKeyTransacted"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwOpenKeyTransactedEx"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"ZwCreateKeyTransacted"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtOpenKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"NtCreateKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHRegOpenUSKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"SHRegCreateUSKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"RtlCreateRegistryKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"Microsoft.Win32.RegistryKey::OpenSubKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"Microsoft.Win32.RegistryKey::OpenBaseKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"Microsoft.Win32.RegistryKey::OpenRemoteBaseKey"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"Microsoft.Win32.RegistryKey::CreateSubKey"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"PEB access":{"meta":{"name":"PEB access","authors":["michael.hunhoff@mandiant.com"],"scopes":{"static":"basic block"},"attack":[],"mbc":[{"parts":["Anti-Behavioral Analysis","Debugger Detection","Process Environment Block"],"objective":"Anti-Behavioral Analysis","behavior":"Debugger Detection","method":"Process Environment Block","id":"B0001.019"}],"references":["https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiDebug/NtGlobalFlag.cpp"],"examples":["al-khaser_x86.exe_:0x420D20"],"description":"","lib":true,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: PEB access\r\n    authors:\r\n      - michael.hunhoff@mandiant.com\r\n    lib: true\r\n    scopes:\r\n      static: basic block\r\n      dynamic: unsupported  # requires characteristic, offset, mnemonic features\r\n    mbc:\r\n      - Anti-Behavioral Analysis::Debugger Detection::Process Environment Block [B0001.019]\r\n    references:\r\n      - https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiDebug/NtGlobalFlag.cpp\r\n    examples:\r\n      - al-khaser_x86.exe_:0x420D20\r\n  features:\r\n    - or:\r\n      - characteristic: peb access\r\n      - and:\r\n        # https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiDebug/NtGlobalFlag.cpp#L41\r\n        - arch: i386\r\n        - characteristic: fs access\r\n        - or:\r\n          # in 0f5d5d07c6533bc6d991836ce79daaa1\r\n          # then we have:\r\n          #\r\n          #     xor edx, edx\r\n          #     mov edx, fs:[edx+30h]\r\n          - offset: 0x30\r\n          - instruction:\r\n            # in the case of CallObfuscator, gs:[rax]\r\n            - mnemonic: add\r\n            - number: 0x30\r\n      - and:\r\n        - arch: amd64\r\n        - characteristic: gs access\r\n        - or:\r\n          - offset: 0x60\r\n          - instruction:\r\n            - mnemonic: add\r\n            - number: 0x60\r\n      - and:\r\n        # WoW64 PEB address is fetched via the WoW64 Thread Environment Block (TEB) at FS:[0x18]-0x2000\r\n        # https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiDebug/NtGlobalFlag.cpp#L45\r\n        - characteristic: fs access\r\n        - instruction:\r\n          - mnemonic: sub\r\n          - number: 0x2000\r\n","matches":[[{"type":"absolute","value":6442464582},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"peb access"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"fs access"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"PEB access/9d7880435c974efead46712e388ff364"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"arch","arch":"i386"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"fs access"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"offset","offset":48}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"PEB access/bf91a73f78d8403b8c253a33b4b273a8"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"arch","arch":"amd64"}},"children":[],"locations":[{"type":"no address"}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"gs access"}},"children":[],"locations":[{"type":"absolute","value":6442464596}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"offset","offset":96}},"children":[],"locations":[{"type":"absolute","value":6442464623}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"PEB access/c9144047927f432396a43839121c8b32"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"absolute","value":6442466123},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"peb access"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"fs access"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"PEB access/9d7880435c974efead46712e388ff364"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"arch","arch":"i386"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"fs access"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"offset","offset":48}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"PEB access/bf91a73f78d8403b8c253a33b4b273a8"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"arch","arch":"amd64"}},"children":[],"locations":[{"type":"no address"}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"gs access"}},"children":[],"locations":[{"type":"absolute","value":6442466145}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"offset","offset":96}},"children":[],"locations":[{"type":"absolute","value":6442466154}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"PEB access/c9144047927f432396a43839121c8b32"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"access PEB ldr_data":{"meta":{"name":"access PEB ldr_data","namespace":"linking/runtime-linking","authors":["moritz.raabe@mandiant.com"],"scopes":{"static":"basic block"},"attack":[{"parts":["Execution","Shared Modules"],"tactic":"Execution","technique":"Shared Modules","subtechnique":"","id":"T1129"}],"mbc":[],"references":["https://www.geoffchappell.com/studies/windows/km/ntoskrnl/inc/api/ntpsapi_x/peb_ldr_data.htm","https://github.com/d35ha/CallObfuscator/blob/5834aff9ff4511f1408ae4ce80b79737af4ae77b/ShellCode/shell_x64.asm#L8"],"examples":["3FDFB2D522E7DEECAAAF2F87420F7E75:0x4117B7"],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: access PEB ldr_data\r\n    namespace: linking/runtime-linking\r\n    authors:\r\n      - moritz.raabe@mandiant.com\r\n    scopes:\r\n      static: basic block\r\n      dynamic: unsupported  # requires offset features\r\n    att&ck:\r\n      - Execution::Shared Modules [T1129]\r\n    references:\r\n      - https://www.geoffchappell.com/studies/windows/km/ntoskrnl/inc/api/ntpsapi_x/peb_ldr_data.htm\r\n      - https://github.com/d35ha/CallObfuscator/blob/5834aff9ff4511f1408ae4ce80b79737af4ae77b/ShellCode/shell_x64.asm#L8\r\n    examples:\r\n      - 3FDFB2D522E7DEECAAAF2F87420F7E75:0x4117B7\r\n  features:\r\n    - or:\r\n      - and:\r\n        - arch: i386\r\n        - description: x32\r\n\r\n        - match: PEB access\r\n\r\n        # x86 Windows uses fs:0 to access the TIB which contains SEH information at offset 0\r\n        # checking for fs:0 and a (possibly unrelated) number or offset often results in false positives\r\n\r\n        - offset: 0x0C = PEB.LDR_DATA\r\n\r\n        - or:\r\n          - description: resolve a module list\r\n          - offset: 0x0C = PEB.LDR_DATA.InLoadOrderModuleList\r\n          - offset: 0x14 = PEB.LDR_DATA.InMemoryOrderModuleList\r\n          - offset: 0x1C = PEB.LDR_DATA.InInitializationOrderModuleList\r\n\r\n      - and:\r\n        - arch: amd64\r\n        - description: x64\r\n\r\n        - match: PEB access\r\n\r\n        - offset: 0x18 = PEB.LDR_DATA\r\n\r\n        - or:\r\n          - description: resolve a module list\r\n          - offset: 0x10 = PEB.LDR_DATA.InLoadOrderModuleList\r\n          - offset: 0x20 = PEB.LDR_DATA.InMemoryOrderModuleList\r\n          - offset: 0x30 = PEB.LDR_DATA.InInitializationOrderModuleList\r\n","matches":[[{"type":"absolute","value":6442466123},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"and","description":"x32"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"arch","arch":"i386"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"match","match":"PEB access"}},"children":[{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"peb access"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"fs access"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"PEB access/9d7880435c974efead46712e388ff364"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"arch","arch":"i386"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"fs access"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"offset","offset":48}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"PEB access/bf91a73f78d8403b8c253a33b4b273a8"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"arch","arch":"amd64"}},"children":[],"locations":[{"type":"no address"}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"gs access"}},"children":[],"locations":[{"type":"absolute","value":6442466145}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"offset","offset":96}},"children":[],"locations":[{"type":"absolute","value":6442466154}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"PEB access/c9144047927f432396a43839121c8b32"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[{"type":"absolute","value":6442466123}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"offset","offset":12,"description":"PEB.LDR_DATA"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or","description":"resolve a module list"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"offset","offset":12,"description":"PEB.LDR_DATA.InLoadOrderModuleList"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"offset","offset":20,"description":"PEB.LDR_DATA.InMemoryOrderModuleList"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"offset","offset":28,"description":"PEB.LDR_DATA.InInitializationOrderModuleList"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"and","description":"x64"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"arch","arch":"amd64"}},"children":[],"locations":[{"type":"no address"}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"match","match":"PEB access"}},"children":[{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"peb access"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"fs access"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"PEB access/9d7880435c974efead46712e388ff364"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"arch","arch":"i386"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"fs access"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"offset","offset":48}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"PEB access/bf91a73f78d8403b8c253a33b4b273a8"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"arch","arch":"amd64"}},"children":[],"locations":[{"type":"no address"}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"gs access"}},"children":[],"locations":[{"type":"absolute","value":6442466145}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"offset","offset":96}},"children":[],"locations":[{"type":"absolute","value":6442466154}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"PEB access/c9144047927f432396a43839121c8b32"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[{"type":"absolute","value":6442466123}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"offset","offset":24,"description":"PEB.LDR_DATA"}},"children":[],"locations":[{"type":"absolute","value":6442466168}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or","description":"resolve a module list"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"offset","offset":16,"description":"PEB.LDR_DATA.InLoadOrderModuleList"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"offset","offset":32,"description":"PEB.LDR_DATA.InMemoryOrderModuleList"}},"children":[],"locations":[{"type":"absolute","value":6442466182},{"type":"absolute","value":6442466175}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"offset","offset":48,"description":"PEB.LDR_DATA.InInitializationOrderModuleList"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"encode data using XOR":{"meta":{"name":"encode data using XOR","namespace":"data-manipulation/encoding/xor","authors":["moritz.raabe@mandiant.com"],"scopes":{"static":"basic block"},"attack":[{"parts":["Defense Evasion","Obfuscated Files or Information"],"tactic":"Defense Evasion","technique":"Obfuscated Files or Information","subtechnique":"","id":"T1027"}],"mbc":[{"parts":["Defense Evasion","Obfuscated Files or Information","Encoding-Standard Algorithm"],"objective":"Defense Evasion","behavior":"Obfuscated Files or Information","method":"Encoding-Standard Algorithm","id":"E1027.m02"},{"parts":["Data","Encode Data","XOR"],"objective":"Data","behavior":"Encode Data","method":"XOR","id":"C0026.002"}],"references":[],"examples":["2D3EDC218A90F03089CC01715A9F047F:0x403D7E"],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: encode data using XOR\r\n    namespace: data-manipulation/encoding/xor\r\n    authors:\r\n      - moritz.raabe@mandiant.com\r\n    scopes:\r\n      static: basic block\r\n      dynamic: unsupported  # requires characteristic, Not features\r\n    att&ck:\r\n      - Defense Evasion::Obfuscated Files or Information [T1027]\r\n    mbc:\r\n      - Defense Evasion::Obfuscated Files or Information::Encoding-Standard Algorithm [E1027.m02]\r\n      - Data::Encode Data::XOR [C0026.002]\r\n    examples:\r\n      - 2D3EDC218A90F03089CC01715A9F047F:0x403D7E\r\n  features:\r\n    - and:\r\n      - characteristic: tight loop\r\n      - characteristic: nzxor\r\n      - not:\r\n        - description: filter for potential false positives\r\n        - or:\r\n          - or:\r\n            - description: unsigned bitwise negation operation (~i)\r\n            - number: 0xFFFFFFFF = bitwise negation for unsigned 32 bits\r\n            - number: 0xFFFFFFFFFFFFFFFF = bitwise negation for unsigned 64 bits\r\n          - or:\r\n            - description: signed bitwise negation operation (~i)\r\n            - number: 0x0FFFFFFF = bitwise negation for signed 32 bits\r\n            - number: 0x0FFFFFFFFFFFFFFF = bitwise negation for signed 64 bits\r\n          - or:\r\n            - description: Magic constants used in the implementation of strings functions.\r\n            # such as `strlen` and `strcat` in the Windows standard library:\r\n            # (((i - 0x81010101) ^ ~i) & 0x81010100)\r\n            ## 32 bits\r\n            - number: 0x7EFEFEFF = optimized string constant for 32 bits\r\n            - number: 0x81010101 = -0x81010101 = 0x7EFEFEFF\r\n            - number: 0x81010100 = 0x81010100 = ~0x7EFEFEFF\r\n            ## 64 bits\r\n            - number: 0x7EFEFEFEFEFEFEFF = optimized string constant for 64 bits\r\n            - number: 0x8101010101010101 = -0x8101010101010101 = 0x7EFEFEFEFEFEFEFF\r\n            - number: 0x8101010101010100 = 0x8101010101010100 = ~0x7EFEFEFEFEFEFEFF\r\n","matches":[[{"type":"absolute","value":6442467981},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"tight loop"}},"children":[],"locations":[{"type":"absolute","value":6442467981}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"nzxor"}},"children":[],"locations":[{"type":"absolute","value":6442468034}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"not","description":"filter for potential false positives"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"or","description":"unsigned bitwise negation operation (~i)"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"number","number":4294967295,"description":"bitwise negation for unsigned 32 bits"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":18446744073709551615,"description":"bitwise negation for unsigned 64 bits"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or","description":"signed bitwise negation operation (~i)"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"number","number":268435455,"description":"bitwise negation for signed 32 bits"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":1152921504606846975,"description":"bitwise negation for signed 64 bits"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or","description":"Magic constants used in the implementation of strings functions."}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"number","number":2130640639,"description":"optimized string constant for 32 bits"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":2164326657,"description":"-0x81010101 = 0x7EFEFEFF"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":2164326656,"description":"0x81010100 = ~0x7EFEFEFF"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":9151031864016699135,"description":"optimized string constant for 64 bits"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":9295712209692852481,"description":"-0x8101010101010101 = 0x7EFEFEFEFEFEFEFF"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":9295712209692852480,"description":"0x8101010101010100 = ~0x7EFEFEFEFEFEFEFF"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"absolute","value":6442468298},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"tight loop"}},"children":[],"locations":[{"type":"absolute","value":6442468298}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"nzxor"}},"children":[],"locations":[{"type":"absolute","value":6442468387}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"not","description":"filter for potential false positives"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"or","description":"unsigned bitwise negation operation (~i)"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"number","number":4294967295,"description":"bitwise negation for unsigned 32 bits"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":18446744073709551615,"description":"bitwise negation for unsigned 64 bits"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or","description":"signed bitwise negation operation (~i)"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"number","number":268435455,"description":"bitwise negation for signed 32 bits"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":1152921504606846975,"description":"bitwise negation for signed 64 bits"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or","description":"Magic constants used in the implementation of strings functions."}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"number","number":2130640639,"description":"optimized string constant for 32 bits"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":2164326657,"description":"-0x81010101 = 0x7EFEFEFF"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":2164326656,"description":"0x81010100 = ~0x7EFEFEFF"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":9151031864016699135,"description":"optimized string constant for 64 bits"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":9295712209692852481,"description":"-0x8101010101010101 = 0x7EFEFEFEFEFEFEFF"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":9295712209692852480,"description":"0x8101010101010100 = ~0x7EFEFEFEFEFEFEFF"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"contain loop":{"meta":{"name":"contain loop","authors":["moritz.raabe@mandiant.com"],"scopes":{"static":"function"},"attack":[],"mbc":[],"references":[],"examples":["08AC667C65D36D6542917655571E61C8:0x406EAA"],"description":"","lib":true,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: contain loop\r\n    authors:\r\n      - moritz.raabe@mandiant.com\r\n    lib: true\r\n    scopes:\r\n      static: function\r\n      dynamic: unsupported  # requires characteristic features\r\n    examples:\r\n      - 08AC667C65D36D6542917655571E61C8:0x406EAA\r\n  features:\r\n    - or:\r\n      - characteristic: loop\r\n      - characteristic: tight loop\r\n      - characteristic: recursive call\r\n","matches":[[{"type":"absolute","value":6442455134},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"loop"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"tight loop"}},"children":[],"locations":[{"type":"absolute","value":6442455139}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"recursive call"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"absolute","value":6442455171},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"loop"}},"children":[],"locations":[{"type":"absolute","value":6442455171}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"tight loop"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"recursive call"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"absolute","value":6442455819},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"loop"}},"children":[],"locations":[{"type":"absolute","value":6442455819}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"tight loop"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"recursive call"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"absolute","value":6442457666},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"loop"}},"children":[],"locations":[{"type":"absolute","value":6442457666}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"tight loop"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"recursive call"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"absolute","value":6442464629},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"loop"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"tight loop"}},"children":[],"locations":[{"type":"absolute","value":6442464780},{"type":"absolute","value":6442464735}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"recursive call"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"absolute","value":6442465122},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"loop"}},"children":[],"locations":[{"type":"absolute","value":6442465122}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"tight loop"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"recursive call"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"absolute","value":6442465298},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"loop"}},"children":[],"locations":[{"type":"absolute","value":6442465298}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"tight loop"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"recursive call"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"absolute","value":6442465405},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"loop"}},"children":[],"locations":[{"type":"absolute","value":6442465405}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"tight loop"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"recursive call"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"absolute","value":6442465550},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"loop"}},"children":[],"locations":[{"type":"absolute","value":6442465550}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"tight loop"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"recursive call"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"absolute","value":6442466123},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"loop"}},"children":[],"locations":[{"type":"absolute","value":6442466123}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"tight loop"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"recursive call"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"absolute","value":6442466743},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"loop"}},"children":[],"locations":[{"type":"absolute","value":6442466743}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"tight loop"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"recursive call"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"absolute","value":6442467356},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"loop"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"tight loop"}},"children":[],"locations":[{"type":"absolute","value":6442467423}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"recursive call"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"absolute","value":6442467504},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"loop"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"tight loop"}},"children":[],"locations":[{"type":"absolute","value":6442469203},{"type":"absolute","value":6442469389}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"recursive call"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"absolute","value":6442467716},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"loop"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"tight loop"}},"children":[],"locations":[{"type":"absolute","value":6442467753},{"type":"absolute","value":6442467838}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"recursive call"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"absolute","value":6442467924},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"loop"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"tight loop"}},"children":[],"locations":[{"type":"absolute","value":6442468298},{"type":"absolute","value":6442467981},{"type":"absolute","value":6442468110}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"recursive call"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"absolute","value":6442468713},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"loop"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"tight loop"}},"children":[],"locations":[{"type":"absolute","value":6442468740}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"recursive call"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"absolute","value":6442468784},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"loop"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"tight loop"}},"children":[],"locations":[{"type":"absolute","value":6442468832}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"recursive call"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"absolute","value":6442468933},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"loop"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"tight loop"}},"children":[],"locations":[{"type":"absolute","value":6442468993},{"type":"absolute","value":6442469075}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"recursive call"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"absolute","value":6442469175},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"loop"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"tight loop"}},"children":[],"locations":[{"type":"absolute","value":6442469203},{"type":"absolute","value":6442469389}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"recursive call"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"encrypt data using RC4 KSA":{"meta":{"name":"encrypt data using RC4 KSA","namespace":"data-manipulation/encryption/rc4","authors":["moritz.raabe@mandiant.com"],"scopes":{"static":"function"},"attack":[{"parts":["Defense Evasion","Obfuscated Files or Information"],"tactic":"Defense Evasion","technique":"Obfuscated Files or Information","subtechnique":"","id":"T1027"}],"mbc":[{"parts":["Cryptography","Encrypt Data","RC4"],"objective":"Cryptography","behavior":"Encrypt Data","method":"RC4","id":"C0027.009"},{"parts":["Cryptography","Encryption Key","RC4 KSA"],"objective":"Cryptography","behavior":"Encryption Key","method":"RC4 KSA","id":"C0028.002"}],"references":[],"examples":["34404A3FB9804977C6AB86CB991FB130:0x403D40","9324D1A8AE37A36AE560C37448C9705A:0x404950","2B8BEC5BCB1777EAA155D832F7AFC797:0x405C42","73CE04892E5F39EC82B00C02FC04C70F:0x40646E"],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: encrypt data using RC4 KSA\r\n    namespace: data-manipulation/encryption/rc4\r\n    authors:\r\n      - moritz.raabe@mandiant.com\r\n    scopes:\r\n      static: function\r\n      dynamic: unsupported  # requires characteristic, mnemonic, Not features\r\n    att&ck:\r\n      - Defense Evasion::Obfuscated Files or Information [T1027]\r\n    mbc:\r\n      - Cryptography::Encrypt Data::RC4 [C0027.009]\r\n      - Cryptography::Encryption Key::RC4 KSA [C0028.002]\r\n    examples:\r\n      - 34404A3FB9804977C6AB86CB991FB130:0x403D40\r\n      - 9324D1A8AE37A36AE560C37448C9705A:0x404950\r\n      - 2B8BEC5BCB1777EAA155D832F7AFC797:0x405C42\r\n      - 73CE04892E5F39EC82B00C02FC04C70F:0x40646E\r\n  features:\r\n    - or:\r\n      - and:\r\n        - basic block:\r\n          - and:\r\n            - description: initialize S\r\n            # misses if regular loop is used,\r\n            # however we cannot model that a loop contains a certain number\r\n            - characteristic: tight loop\r\n            - or:\r\n              - number: 0xFF\r\n              - number: 0x100\r\n        - or:\r\n          - description: modulo 256\r\n          - match: calculate modulo 256 via x86 assembly\r\n          - basic block:\r\n            - and:\r\n              - description: modulo via zero-extended mov from 8-bit register\r\n              - count(mnemonic(movzx)): 2 or more\r\n              # avoid false positives; filter out unexpected instructions\r\n              - not:\r\n                - or:\r\n                  - mnemonic: shl\r\n                  - mnemonic: rol\r\n                  - characteristic: nzxor\r\n        - or:\r\n          - description: modulo key length\r\n          - mnemonic: div\r\n          - mnemonic: idiv\r\n      - and:\r\n        - description: write DWORDs instead of bytes\r\n        - or:\r\n          - number: 0x03020100\r\n          - number: 0xFFFEFDFC\r\n        - instruction:\r\n          - or:\r\n            - mnemonic: add\r\n            - mnemonic: sub\r\n          - number: 0x04040404\r\n","matches":[[{"type":"absolute","value":6442464629},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"and","description":"write DWORDs instead of bytes"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"number","number":50462976}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":4294901244}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"encrypt data using RC4 KSA/6109c492966e403da5ce7830a3332ee9"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"statement","statement":{"type":"subscope","scope":"basic block"}},"children":[{"success":true,"node":{"type":"statement","statement":{"type":"and","description":"initialize S"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"tight loop"}},"children":[],"locations":[{"type":"absolute","value":6442464780}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"number","number":255}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"number","number":256}},"children":[],"locations":[{"type":"absolute","value":6442464998},{"type":"absolute","value":6442464791}],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"and","description":"initialize S"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"tight loop"}},"children":[],"locations":[{"type":"absolute","value":6442464735}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"number","number":255}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"number","number":256}},"children":[],"locations":[{"type":"absolute","value":6442464768}],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[{"type":"absolute","value":6442464780},{"type":"absolute","value":6442464735}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or","description":"modulo 256"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"calculate modulo 256 via x86 assembly"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"subscope","scope":"basic block"}},"children":[{"success":true,"node":{"type":"statement","statement":{"type":"and","description":"modulo via zero-extended mov from 8-bit register"}},"children":[{"success":true,"node":{"type":"statement","statement":{"type":"range","min":2,"max":9223372036854775808,"child":{"type":"mnemonic","mnemonic":"movzx"}}},"children":[],"locations":[{"type":"absolute","value":6442464827},{"type":"absolute","value":6442464860}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"not"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"mnemonic","mnemonic":"shl"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"mnemonic","mnemonic":"rol"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"nzxor"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[{"type":"absolute","value":6442464780}],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or","description":"modulo key length"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"mnemonic","mnemonic":"div"}},"children":[],"locations":[{"type":"absolute","value":6442464850}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"mnemonic","mnemonic":"idiv"}},"children":[],"locations":[{"type":"absolute","value":6442464875}],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"parse PE header":{"meta":{"name":"parse PE header","namespace":"load-code/pe","authors":["moritz.raabe@mandiant.com"],"scopes":{"static":"function"},"attack":[{"parts":["Execution","Shared Modules"],"tactic":"Execution","technique":"Shared Modules","subtechnique":"","id":"T1129"}],"mbc":[],"references":[],"examples":["9324D1A8AE37A36AE560C37448C9705A:0x403DD0"],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: parse PE header\r\n    namespace: load-code/pe\r\n    authors:\r\n      - moritz.raabe@mandiant.com\r\n    scopes:\r\n      static: function\r\n      dynamic: unsupported  # requires mnemonic, operand[1].offset features\r\n    att&ck:\r\n      - Execution::Shared Modules [T1129]\r\n    examples:\r\n      - 9324D1A8AE37A36AE560C37448C9705A:0x403DD0\r\n  features:\r\n    - and:\r\n      - os: windows\r\n      - and:\r\n        - mnemonic: cmp\r\n        - or:\r\n          - number: 0x4550 = IMAGE_NT_SIGNATURE (PE)\r\n          - and:\r\n            - number: 0x50\r\n            - number: 0x45\r\n        - or:\r\n          - number: 0x5A4D = IMAGE_DOS_SIGNATURE (MZ)\r\n          - and:\r\n            - number: 0x4D\r\n            - number: 0x5A\r\n        - optional:\r\n          - and:\r\n            - operand[1].offset: 0x3C = IMAGE_DOS_HEADER.e_lfanew\r\n            - or:\r\n              - and:\r\n                - arch: i386\r\n                - operand[1].offset: 0x50 = IMAGE_NT_HEADERS.OptionalHeader.SizeOfImage\r\n                - operand[1].offset: 0x34 = IMAGE_NT_HEADERS.OptionalHeader.ImageBase\r\n              - and:\r\n                - arch: amd64\r\n                - operand[1].offset: 0x50 = IMAGE_NT_HEADERS64.OptionalHeader.SizeOfImage\r\n                - operand[1].offset: 0x30 = IMAGE_NT_HEADERS64.OptionalHeader.ImageBase\r\n          - basic block:\r\n            - and:\r\n              - operand[1].offset: 0x3C = IMAGE_DOS_HEADER.e_lfanew\r\n              - 3 or more:\r\n                - operand[1].offset: 0x4 = IMAGE_NT_HEADERS.FileHeader.Machine\r\n                - operand[1].offset: 0x6 = IMAGE_NT_HEADERS.FileHeader.NumberOfSections\r\n                - operand[1].offset: 0x14 = IMAGE_NT_HEADERS.FileHeader.SizeOfOptionalHeader\r\n                - operand[1].offset: 0x16 = IMAGE_NT_HEADERS.FileHeader.Characteristics\r\n                - operand[1].offset: 0x28 = IMAGE_NT_HEADERS.OptionalHeader.AddressOfEntryPoint  # for 32 and 64 bit\r\n                - or:\r\n                  - and:\r\n                    - arch: i386\r\n                    - operand[1].offset: 0x34 = IMAGE_NT_HEADERS.OptionalHeader.ImageBase\r\n                    - operand[1].offset: 0x50 = IMAGE_NT_HEADERS.OptionalHeader.SizeOfImage\r\n                  - and:\r\n                    - arch: amd64\r\n                    - operand[1].offset: 0x30 = IMAGE_NT_HEADERS.OptionalHeader.ImageBase\r\n                    - operand[1].offset: 0x50 = IMAGE_NT_HEADERS64.OptionalHeader.SizeOfImage\r\n","matches":[[{"type":"absolute","value":6442465298},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"os","os":"windows"}},"children":[],"locations":[{"type":"no address"}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"mnemonic","mnemonic":"cmp"}},"children":[],"locations":[{"type":"absolute","value":6442465352},{"type":"absolute","value":6442465338}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"number","number":17744,"description":"IMAGE_NT_SIGNATURE (PE)"}},"children":[],"locations":[{"type":"absolute","value":6442465338}],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"number","number":80}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":69}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"number","number":23117,"description":"IMAGE_DOS_SIGNATURE (MZ)"}},"children":[],"locations":[{"type":"absolute","value":6442465352}],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"number","number":77}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":90}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"operand offset","index":1,"operand_offset":60,"description":"IMAGE_DOS_HEADER.e_lfanew"}},"children":[],"locations":[{"type":"absolute","value":6442465323}],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"arch","arch":"i386"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"operand offset","index":1,"operand_offset":80,"description":"IMAGE_NT_HEADERS.OptionalHeader.SizeOfImage"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"operand offset","index":1,"operand_offset":52,"description":"IMAGE_NT_HEADERS.OptionalHeader.ImageBase"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"arch","arch":"amd64"}},"children":[],"locations":[{"type":"no address"}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"operand offset","index":1,"operand_offset":80,"description":"IMAGE_NT_HEADERS64.OptionalHeader.SizeOfImage"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"operand offset","index":1,"operand_offset":48,"description":"IMAGE_NT_HEADERS64.OptionalHeader.ImageBase"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"parse PE header/95af70cf6fb0482ab5ddecde71e3b40a"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],[{"type":"absolute","value":6442465405},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"os","os":"windows"}},"children":[],"locations":[{"type":"no address"}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"mnemonic","mnemonic":"cmp"}},"children":[],"locations":[{"type":"absolute","value":6442465459},{"type":"absolute","value":6442465478},{"type":"absolute","value":6442465438}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"number","number":17744,"description":"IMAGE_NT_SIGNATURE (PE)"}},"children":[],"locations":[{"type":"absolute","value":6442465478}],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"number","number":80}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":69}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"number","number":23117,"description":"IMAGE_DOS_SIGNATURE (MZ)"}},"children":[],"locations":[{"type":"absolute","value":6442465459}],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"number","number":77}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"number","number":90}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"operand offset","index":1,"operand_offset":60,"description":"IMAGE_DOS_HEADER.e_lfanew"}},"children":[],"locations":[{"type":"absolute","value":6442465474}],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"arch","arch":"i386"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"operand offset","index":1,"operand_offset":80,"description":"IMAGE_NT_HEADERS.OptionalHeader.SizeOfImage"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"operand offset","index":1,"operand_offset":52,"description":"IMAGE_NT_HEADERS.OptionalHeader.ImageBase"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"arch","arch":"amd64"}},"children":[],"locations":[{"type":"no address"}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"operand offset","index":1,"operand_offset":80,"description":"IMAGE_NT_HEADERS64.OptionalHeader.SizeOfImage"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"operand offset","index":1,"operand_offset":48,"description":"IMAGE_NT_HEADERS64.OptionalHeader.ImageBase"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"match","match":"parse PE header/95af70cf6fb0482ab5ddecde71e3b40a"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"encrypt data using RC4 PRGA":{"meta":{"name":"encrypt data using RC4 PRGA","namespace":"data-manipulation/encryption/rc4","authors":["moritz.raabe@mandiant.com"],"scopes":{"static":"function"},"attack":[{"parts":["Defense Evasion","Obfuscated Files or Information"],"tactic":"Defense Evasion","technique":"Obfuscated Files or Information","subtechnique":"","id":"T1027"}],"mbc":[{"parts":["Cryptography","Encrypt Data","RC4"],"objective":"Cryptography","behavior":"Encrypt Data","method":"RC4","id":"C0027.009"},{"parts":["Cryptography","Generate Pseudo-random Sequence","RC4 PRGA"],"objective":"Cryptography","behavior":"Generate Pseudo-random Sequence","method":"RC4 PRGA","id":"C0021.004"}],"references":[],"examples":["34404A3FB9804977C6AB86CB991FB130:0x403DB0","34404A3FB9804977C6AB86CB991FB130:0x403E50","9324D1A8AE37A36AE560C37448C9705A:0x4049F0","73CE04892E5F39EC82B00C02FC04C70F:0x4064C6"],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: encrypt data using RC4 PRGA\r\n    namespace: data-manipulation/encryption/rc4\r\n    authors:\r\n      - moritz.raabe@mandiant.com\r\n    scopes:\r\n      static: function\r\n      dynamic: unsupported  # requires characteristic, mnemonic, basicblock features\r\n    att&ck:\r\n      - Defense Evasion::Obfuscated Files or Information [T1027]\r\n    mbc:\r\n      - Cryptography::Encrypt Data::RC4 [C0027.009]\r\n      - Cryptography::Generate Pseudo-random Sequence::RC4 PRGA [C0021.004]\r\n    examples:\r\n      - 34404A3FB9804977C6AB86CB991FB130:0x403DB0\r\n      - 34404A3FB9804977C6AB86CB991FB130:0x403E50\r\n      - 9324D1A8AE37A36AE560C37448C9705A:0x4049F0\r\n      - 73CE04892E5F39EC82B00C02FC04C70F:0x4064C6\r\n  features:\r\n    - and:\r\n      # TODO: maybe add characteristic for nzxor reg size\r\n      - count(characteristic(nzxor)): 1\r\n      - or:\r\n        - match: calculate modulo 256 via x86 assembly\r\n        # compiler may do this via zero-extended mov from 8-bit register\r\n        - count(mnemonic(movzx)): 4 or more\r\n      # should not call (many) functions\r\n      - count(characteristic(calls from)): (0, 4)\r\n      # should not be too simple or too complex (50 is picked by intuition)\r\n      - count(basic blocks): (4, 50)\r\n      - match: contain loop\r\n      - optional:\r\n        - or:\r\n          - number: 0xFF\r\n          - number: 0x100\r\n","matches":[[{"type":"absolute","value":6442465550},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"match","match":"contain loop"}},"children":[{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"loop"}},"children":[],"locations":[{"type":"absolute","value":6442465550}],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"tight loop"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"recursive call"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[{"type":"absolute","value":6442465550}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"range","min":1,"max":1,"child":{"type":"characteristic","characteristic":"nzxor"}}},"children":[],"locations":[{"type":"absolute","value":6442465899}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"range","min":0,"max":4,"child":{"type":"characteristic","characteristic":"calls from"}}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"range","min":4,"max":50,"child":{"type":"basic block"}}},"children":[],"locations":[{"type":"absolute","value":6442465648},{"type":"absolute","value":6442465977},{"type":"absolute","value":6442465687},{"type":"absolute","value":6442465929},{"type":"absolute","value":6442465550}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"match","match":"calculate modulo 256 via x86 assembly"}},"children":[{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"arch","arch":"i386"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"arch","arch":"amd64"}},"children":[],"locations":[{"type":"no address"}],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"mnemonic","mnemonic":"and"}},"children":[],"locations":[{"type":"absolute","value":6442465853}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"number","number":2147483903}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"number","number":255}},"children":[],"locations":[{"type":"absolute","value":6442465853}],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[{"type":"absolute","value":6442465853}],"captures":{}},{"success":false,"node":{"type":"statement","statement":{"type":"range","min":4,"max":9223372036854775808,"child":{"type":"mnemonic","mnemonic":"movzx"}}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"number","number":255}},"children":[],"locations":[{"type":"absolute","value":6442465853}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"number","number":256}},"children":[],"locations":[{"type":"absolute","value":6442465701}],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"resolve function by parsing PE exports":{"meta":{"name":"resolve function by parsing PE exports","namespace":"load-code/pe","authors":["sara-rn"],"scopes":{"static":"function"},"attack":[],"mbc":[],"references":[],"examples":["73CE04892E5F39EC82B00C02FC04C70F:0x406BA1"],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: resolve function by parsing PE exports\r\n    namespace: load-code/pe\r\n    authors:\r\n      - sara-rn\r\n    scopes:\r\n      static: function\r\n      dynamic: unsupported  # requires characteristic, offset, mnemonic features\r\n    examples:\r\n      - 73CE04892E5F39EC82B00C02FC04C70F:0x406BA1\r\n  features:\r\n    - and:\r\n      - os: windows\r\n      - or:\r\n        - characteristic: loop\r\n        - mnemonic: movzx\r\n      - and:\r\n        - offset: 0x3C = IMAGE_DOS_HEADER.PE.e_lfanew\r\n        - or:\r\n          - and:\r\n            - arch: i386\r\n            - offset: 0x78 = offset to IMAGE_DATA_DIRECTORY[IMAGE_DIRECTORY_ENTRY_EXPORT]\r\n          - and:\r\n            - arch: amd64\r\n            - offset: 0x88 = offset to IMAGE_DATA_DIRECTORY[IMAGE_DIRECTORY_ENTRY_EXPORT]\r\n        - 3 or more:\r\n          - offset: 0x14 = IMAGE_EXPORT_DIRECTORY.NumberOfFunctions\r\n          - offset: 0x24 = IMAGE_EXPORT_DIRECTORY.AddressOfNameOrdinals\r\n          - offset: 0x20 = IMAGE_EXPORT_DIRECTORY.AddressOfNames\r\n          - offset: 0x18 = IMAGE_EXPORT_DIRECTORY.NumberOfNames\r\n          - offset: 0x1C = IMAGE_EXPORT_DIRECTORY.AddressOfFunctions\r\n      - optional:\r\n        - or:\r\n          - api: LoadLibrary\r\n          - api: strcmp\r\n","matches":[[{"type":"absolute","value":6442466743},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"os","os":"windows"}},"children":[],"locations":[{"type":"no address"}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"characteristic","characteristic":"loop"}},"children":[],"locations":[{"type":"absolute","value":6442466743}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"mnemonic","mnemonic":"movzx"}},"children":[],"locations":[{"type":"absolute","value":6442467305}],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"optional"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"LoadLibrary"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"api","api":"strcmp"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"offset","offset":60,"description":"IMAGE_DOS_HEADER.PE.e_lfanew"}},"children":[],"locations":[{"type":"absolute","value":6442466772}],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"arch","arch":"i386"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"offset","offset":120,"description":"offset to IMAGE_DATA_DIRECTORY[IMAGE_DIRECTORY_ENTRY_EXPORT]"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"and"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"arch","arch":"amd64"}},"children":[],"locations":[{"type":"no address"}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"offset","offset":136,"description":"offset to IMAGE_DATA_DIRECTORY[IMAGE_DIRECTORY_ENTRY_EXPORT]"}},"children":[],"locations":[{"type":"absolute","value":6442466809}],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}},{"success":true,"node":{"type":"statement","statement":{"type":"some","count":3}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"offset","offset":20,"description":"IMAGE_EXPORT_DIRECTORY.NumberOfFunctions"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"offset","offset":36,"description":"IMAGE_EXPORT_DIRECTORY.AddressOfNameOrdinals"}},"children":[],"locations":[{"type":"absolute","value":6442466887}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"offset","offset":32,"description":"IMAGE_EXPORT_DIRECTORY.AddressOfNames"}},"children":[],"locations":[{"type":"absolute","value":6442466819}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"offset","offset":24,"description":"IMAGE_EXPORT_DIRECTORY.NumberOfNames"}},"children":[],"locations":[{"type":"absolute","value":6442466843}],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"offset","offset":28,"description":"IMAGE_EXPORT_DIRECTORY.AddressOfFunctions"}},"children":[],"locations":[{"type":"absolute","value":6442467294}],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"reference anti-VM strings":{"meta":{"name":"reference anti-VM strings","namespace":"anti-analysis/anti-vm/vm-detection","authors":["moritz.raabe@mandiant.com"],"scopes":{"static":"file","dynamic":"file"},"attack":[{"parts":["Defense Evasion","Virtualization/Sandbox Evasion","System Checks"],"tactic":"Defense Evasion","technique":"Virtualization/Sandbox Evasion","subtechnique":"System Checks","id":"T1497.001"}],"mbc":[{"parts":["Anti-Behavioral Analysis","Virtual Machine Detection"],"objective":"Anti-Behavioral Analysis","behavior":"Virtual Machine Detection","method":"","id":"B0009"}],"references":["https://github.com/ctxis/CAPE/blob/master/modules/signatures/antivm_*","https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiVM/Generic.cpp"],"examples":["Practical Malware Analysis Lab 17-02.dll_"],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: reference anti-VM strings\r\n    namespace: anti-analysis/anti-vm/vm-detection\r\n    authors:\r\n      - moritz.raabe@mandiant.com\r\n    scopes:\r\n      static: file\r\n      dynamic: file\r\n    att&ck:\r\n      - Defense Evasion::Virtualization/Sandbox Evasion::System Checks [T1497.001]\r\n    mbc:\r\n      - Anti-Behavioral Analysis::Virtual Machine Detection [B0009]\r\n    references:\r\n      - https://github.com/ctxis/CAPE/blob/master/modules/signatures/antivm_*\r\n      - https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiVM/Generic.cpp\r\n    examples:\r\n      - Practical Malware Analysis Lab 17-02.dll_\r\n  features:\r\n    - or:\r\n      - string: /HARDWARE\\\\ACPI\\\\(DSDT|FADT|RSDT)\\\\BOCHS/i\r\n      - string: /HARDWARE\\\\DESCRIPTION\\\\System\\\\(SystemBiosVersion|VideoBiosVersion)/i\r\n      - string: /HARDWARE\\\\DESCRIPTION\\\\System\\\\CentralProcessor/i\r\n      - string: /HARDWARE\\\\DEVICEMAP\\\\Scsi\\\\Scsi Port 0\\\\Scsi Bus 0\\\\Target Id 0\\\\Logical Unit Id 0/i\r\n      - string: /SYSTEM\\\\(ControlSet\\d{3}|CurrentControlSet)\\\\Enum\\\\IDE/i\r\n      - string: /SYSTEM\\\\(ControlSet\\d{3}|CurrentControlSet)\\\\Services\\\\Disk\\\\Enum\\\\/i\r\n      - string: /SYSTEM\\\\(ControlSet\\d{3}|CurrentControlSet)\\\\Control\\\\SystemInformation\\\\SystemManufacturer/i\r\n      - string: /A M I/i\r\n      - string: /Hyper-V/i\r\n      - string: /Kernel-VMDetection-Private/i\r\n      # https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiVM/Generic.cpp#L699\r\n      - string: /KVMKVMKVM/i\r\n        description: KVM\r\n      - string: /Microsoft Hv/i\r\n        description: Microsoft Hyper-V or Windows Virtual PC\r\n      # https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiVM/Generic.cpp#L8\r\n      - string: /avghookx\\.dll/i\r\n        description: AVG\r\n      - string: /avghooka\\.dll/i\r\n        description: AVG\r\n      - string: /snxhk\\.dll/i\r\n        description: Avast\r\n      - string: /pstorec\\.dll/i\r\n        description: SunBelt Sandbox\r\n      - string: /vmcheck\\.dll/i\r\n        description: Virtual PC\r\n      - string: /wpespy\\.dll/i\r\n        description: WPE Pro\r\n      - string: /cmdvrt64\\.dll/i\r\n        description: Comodo Container\r\n      - string: /cmdvrt32\\.dll/i\r\n        description: Comodo Container\r\n      # https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiVM/Generic.cpp#L46\r\n      - string: /sample\\.exe/i\r\n      - string: /bot\\.exe/i\r\n      - string: /sandbox\\.exe/i\r\n      - string: /malware\\.exe/i\r\n      - string: /test\\.exe/i\r\n      - string: /klavme\\.exe/i\r\n      - string: /myapp\\.exe/i\r\n      - string: /testapp\\.exe/i\r\n","matches":[[{"type":"no address"},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":false,"node":{"type":"feature","feature":{"type":"regex","regex":"/HARDWARE\\\\ACPI\\\\(DSDT|FADT|RSDT)\\\\BOCHS/i"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"regex","regex":"/HARDWARE\\\\DESCRIPTION\\\\System\\\\(SystemBiosVersion|VideoBiosVersion)/i"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"regex","regex":"/HARDWARE\\\\DESCRIPTION\\\\System\\\\CentralProcessor/i"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"regex","regex":"/HARDWARE\\\\DEVICEMAP\\\\Scsi\\\\Scsi Port 0\\\\Scsi Bus 0\\\\Target Id 0\\\\Logical Unit Id 0/i"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"regex","regex":"/SYSTEM\\\\(ControlSet\\d{3}|CurrentControlSet)\\\\Enum\\\\IDE/i"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"regex","regex":"/SYSTEM\\\\(ControlSet\\d{3}|CurrentControlSet)\\\\Services\\\\Disk\\\\Enum\\\\/i"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"regex","regex":"/SYSTEM\\\\(ControlSet\\d{3}|CurrentControlSet)\\\\Control\\\\SystemInformation\\\\SystemManufacturer/i"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"regex","regex":"/A M I/i"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"regex","regex":"/Hyper-V/i"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"regex","regex":"/Kernel-VMDetection-Private/i"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"regex","regex":"/KVMKVMKVM/i","description":"KVM"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"regex","regex":"/Microsoft Hv/i","description":"Microsoft Hyper-V or Windows Virtual PC"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"regex","regex":"/avghookx\\.dll/i","description":"AVG"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"regex","regex":"/avghooka\\.dll/i","description":"AVG"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"regex","regex":"/snxhk\\.dll/i","description":"Avast"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"regex","regex":"/pstorec\\.dll/i","description":"SunBelt Sandbox"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"regex","regex":"/vmcheck\\.dll/i","description":"Virtual PC"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"regex","regex":"/wpespy\\.dll/i","description":"WPE Pro"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"regex","regex":"/cmdvrt64\\.dll/i","description":"Comodo Container"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"regex","regex":"/cmdvrt32\\.dll/i","description":"Comodo Container"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"regex","regex":"/sample\\.exe/i"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"regex","regex":"/bot\\.exe/i"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"regex","regex":"/sandbox\\.exe/i"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"regex","regex":"/malware\\.exe/i"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"regex","regex":"/test\\.exe/i"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"regex","regex":"/klavme\\.exe/i"}},"children":[],"locations":[],"captures":{}},{"success":true,"node":{"type":"feature","feature":{"type":"regex","regex":"/myapp\\.exe/i"}},"children":[],"locations":[{"type":"file","value":20850}],"captures":{"myaPp.exe":[{"type":"file","value":20850}]}},{"success":false,"node":{"type":"feature","feature":{"type":"regex","regex":"/testapp\\.exe/i"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]},"reference anti-VM strings targeting Xen":{"meta":{"name":"reference anti-VM strings targeting Xen","namespace":"anti-analysis/anti-vm/vm-detection","authors":["michael.hunhoff@mandiant.com"],"scopes":{"static":"file","dynamic":"file"},"attack":[{"parts":["Defense Evasion","Virtualization/Sandbox Evasion","System Checks"],"tactic":"Defense Evasion","technique":"Virtualization/Sandbox Evasion","subtechnique":"System Checks","id":"T1497.001"}],"mbc":[{"parts":["Anti-Behavioral Analysis","Virtual Machine Detection"],"objective":"Anti-Behavioral Analysis","behavior":"Virtual Machine Detection","method":"","id":"B0009"}],"references":["https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiVM/Xen.cpp"],"examples":["al-khaser_x86.exe_"],"description":"","lib":false,"is_subscope_rule":false,"maec":{}},"source":"rule:\r\n  meta:\r\n    name: reference anti-VM strings targeting Xen\r\n    namespace: anti-analysis/anti-vm/vm-detection\r\n    authors:\r\n      - michael.hunhoff@mandiant.com\r\n    scopes:\r\n      static: file\r\n      dynamic: file\r\n    att&ck:\r\n      - Defense Evasion::Virtualization/Sandbox Evasion::System Checks [T1497.001]\r\n    mbc:\r\n      - Anti-Behavioral Analysis::Virtual Machine Detection [B0009]\r\n    references:\r\n      - https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiVM/Xen.cpp\r\n    examples:\r\n      - al-khaser_x86.exe_\r\n  features:\r\n    - or:\r\n      - string: /^Xen/i\r\n      - string: /XenVMMXenVMM/i\r\n      - string: /xenservice\\.exe/i\r\n      - string: /HVM domU/i\r\n","matches":[[{"type":"no address"},{"success":true,"node":{"type":"statement","statement":{"type":"or"}},"children":[{"success":true,"node":{"type":"feature","feature":{"type":"regex","regex":"/^Xen/i"}},"children":[],"locations":[{"type":"file","value":1317952},{"type":"file","value":2649503}],"captures":{"xeNs":[{"type":"file","value":1317952}],"XEno":[{"type":"file","value":2649503}]}},{"success":false,"node":{"type":"feature","feature":{"type":"regex","regex":"/XenVMMXenVMM/i"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"regex","regex":"/xenservice\\.exe/i"}},"children":[],"locations":[],"captures":{}},{"success":false,"node":{"type":"feature","feature":{"type":"regex","regex":"/HVM domU/i"}},"children":[],"locations":[],"captures":{}}],"locations":[],"captures":{}}]]}}}
